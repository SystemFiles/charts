apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: cilium
  namespace: argocd-system
  annotations:
    argocd.argoproj.io/sync-wave: "0"
  finalizers:
  - resources-finalizer.argocd.argoproj.io
spec:
  project: default
  source:
    repoURL: https://helm.cilium.io/
    targetRevision: 1.14.4
    chart: cilium
    helm:
      values: |
        cluster:
          id: {{ .Values.application.cilium.id | default 1 }}
          name: {{ .Values.application.cilium.clusterName | default "sykesdev-main" }}
        priorityClassName: system-critical
        resources:
          limits:
            cpu: 2000m
            memory: 2Gi
          requests:
            cpu: 100m
            memory: 512Mi
        nat46x64Gateway:
          enabled: false
        bgpControlPlane:
          enabled: true
        cni:
          install: true
          uninstall: false
        gatewayAPI:
          enabled: true
        hubble:
          enabled: false
          relay:
            enabled: false
          ui:
            enabled: false
        ipam:
          mode: kubernetes
        ipv4:
          enabled: true
        ipv6:
          enabled: false
        k8s:
          requireIPv4PodCIDR: true
          requireIPv6PodCIDR: false
        enableIPv4Masquerade: true
        enableIPv6Masquerade: false
        routingMode: native
        operator:
          enabled: true
          replicas: 1
          podDisruptionBudget:
            enabled: true
            maxUnavailable: 1
  destination:
    server: https://kubernetes.default.svc
    namespace: cilium-system
  syncPolicy:
    automated:
      selfHeal: true
